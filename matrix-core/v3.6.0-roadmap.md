# v3.6.0 Roadmap - Matrix Core Review

## Findings
1. `rowIndices` never evaluates the criteria due to an extra closure block; callers like `removeEmptyRows` will always receive an empty index list. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:2139`
2. `dropExcept(int...)` removes columns while iterating forward, so index shifts can keep columns that should be removed. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:953`
3. `diff` and `checkValues` use `?: Double.NaN`, which treats `0` as falsey and can hide numeric differences when comparing against zero. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:895` and `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:1111`
4. `assertNotEquals` and `assertContentNotEquals` create exceptions without throwing them, so negative assertions never fail. `matrix-core/src/main/groovy/se/alipsa/matrix/core/MatrixAssertions.groovy:17`
5. `removeRows(List)` calls `Arrays.sort(indexes)` which does not sort a List, so row removal order is undefined for unsorted input. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:1949`
6. `split(int chunkSize)` uses `rowCount().intdiv(chunkSize)` and the doc example contradicts the parameter name; `chunkSize > rowCount()` yields `collate(0)`. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:2240`
7. `dropEmptyColumns` claims to drop null and blank-string columns but only checks for null values. `matrix-core/src/main/groovy/se/alipsa/matrix/core/Matrix.groovy:1968`
8. `ListConverter.convert` uses reversed `isAssignableFrom`, so values already assignable to the target type still go through conversion. `matrix-core/src/main/groovy/se/alipsa/matrix/core/ListConverter.groovy:23`

## Plan
1. Matrix-core correctness fixes
  1.1 [ ] Fix `rowIndices` to execute the criteria and add a regression test for `removeEmptyRows`.
  1.2 [ ] Rewrite `dropExcept(int...)` to avoid index-shift removal bugs; add coverage.
  1.3 [ ] Update `diff` and `checkValues` to handle nulls explicitly without treating `0` as false; add diff regression tests.
  1.4 [ ] Throw exceptions in `MatrixAssertions` negative asserts; add tests for `assertNotEquals`/`assertContentNotEquals`.
  1.5 [ ] Replace `Arrays.sort(indexes)` with `indexes.sort()` (or `Collections.sort`) and test unsorted index removal.
  1.6 [ ] Clarify `split(int chunkSize)` semantics (size vs. count) and update implementation/docs/tests accordingly.
  1.7 [ ] Align `dropEmptyColumns` behavior with its docstring (treat blanks as empty) or update docs; add tests.
  1.8 [ ] Fix `ListConverter.convert` assignability check to `type.isAssignableFrom(it.class)` and add a supertype conversion test.
  1.9 [ ] Run tests: `./gradlew :matrix-core:test`.
