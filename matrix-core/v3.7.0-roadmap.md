# Matrix Core v3.7.0 Release Roadmap

This document captures the core enhancements suggested in the R and Python comparison
notes (`docs/R-comparison.md`, `docs/python-comparison.md`) and scopes them to
matrix-core.

## Summary


Note: Several items here introduce breaking changes (e.g. operator semantics, visibility changes). Before implementing any roadmap task, assess impacts across other matrix modules and update their APIs/tests as needed.


v3.7.0 focuses on core data-frame ergonomics and time-series utilities: rolling/window
operations, cumulative stats, and diff/shift APIs. It also explores larger structural
gaps (multi-index and N-D arrays).

---

## Priority 1: Time-Series & Column Ops (Must Do)

### 1.1 [ ] Rolling/Window API (Matrix + Column)
- Add `rolling(window:, minPeriods:, center:, by:)` entry points
- Support built-ins: `mean()`, `sum()`, `min()`, `max()`, `sd()` and `apply {}`
- Ensure NA/null handling is well-defined

### 1.2 [ ] Cumulative operations on Column
- Add `cumsum()`, `cumprod()`, `cummin()`, `cummax()`
- Provide `Matrix` convenience wrappers for per-column cumulative ops

### 1.3 [ ] Diff/Shift/Lag/Lead on Column
- Add `diff(periods = 1)`, `shift(periods)`, `lag(n)`, `lead(n)`
- Define behaviour for nulls and boundary padding

### 1.4 [ ] Tests for rolling/cumulative/diff
- Unit tests for edge cases (nulls, empty, single row, large windows)
- Performance sanity checks on larger columns

### 1.5 [ ] Add filter() alias for subset()
- Provide `filter(Closure)` on Matrix (and optionally Column) mirroring common library naming
- Keep `subset` as primary API for backwards compatibility

### 1.6 [ ] Strengthen Grid type validation
- Pass the target element type into `Grid.isValid()` (or equivalent) to verify row contents
- Guard against type-erasure allowing mixed element types in `Grid(List<List<T>> data)` constructors

### 1.7 [ ] Align row/column operator semantics (breaking)
- Matrix: make `leftShift` (`<<`) append rows (like Grid), and `and` (`&`) append columns
- Add deprecation guidance/migration notes for existing `<<`/`&` usage
- Add Javadoc now (in patch releases) to announce the upcoming semantic swap
  and point to the v3.7.0 migration notes

### 1.8 [ ] Remove renameColumn(String, String)
- Remove deprecated `renameColumn(String before, String after)` in favor of `rename(...)`
- Marked for removal in Javadoc and via `@Deprecated(forRemoval = true, since = "3.7.0")`

### 1.9 [ ] Make createObjectTypes private
- `Matrix.createObjectTypes(Collection)` is internal-only; tighten visibility to private

### 1.10 [ ] Make containsValues private
- `Matrix.containsValues(Iterable)` is internal-only; tighten visibility to private
- Add Javadoc heads-up in 3.6.x patch releases to signal the 3.7.0 change


### 1.11 [ ] Make handleError private
- `Matrix.handleError(String, boolean)` is internal-only; tighten visibility to private
- Add Javadoc heads-up in 3.6.x patch releases to signal the 3.7.0 change


## Priority 1.11: Matrix refactor helpers (Must Do)

### 1.11.1 [ ] Create helper package and extract static helpers
- Introduce a dedicated helper package (e.g. `se.alipsa.matrix.core.helper`)
- Extract static helper classes organized by functional area (selection, conversion, formatting, sorting, etc.)
- Delegate from `Matrix` to these helpers to reduce class size and improve readability
- Keep public API behavior unchanged; helpers should be internal-only


### 1.11.2 [ ] Audit missing Matrix unit tests
- Identify public Matrix methods lacking coverage
- Add focused unit tests for uncovered behaviors (edge cases, null handling, error paths)


### 1.11.3 [ ] Move RowExtension/ColumnExtension into core ext package
- Move `RowExtension` and `ColumnExtension` to `se.alipsa.matrix.core.ext`
- Update extension module descriptors and imports accordingly
- Keep extension method behavior unchanged

---

## Priority 2: Structural Gaps (Research/Design)

### 2.1 [ ] Multi-index / hierarchical indexing
- Define API proposal (row index levels, column index levels)
- Determine storage model and performance impact

### 2.2 [ ] N-dimensional arrays
- Explore extending `Grid` to NDArray or new `Tensor` class
- Define interoperability with Matrix (reshape, flatten, etc.)

---

## Priority 3: Convenience and Interop (Nice to Have)

### 3.1 [ ] Pipe-style chaining helper
- Add `pipe(Closure)` to Matrix/Column as the primary API
- Add `or(Closure)` (operator `|`) as syntactic sugar for piping
- Example usage:
  `matrix.pipe { it.selectColumns('a', 'b') }.pipe { it.orderBy('a') }`
  `matrix | { it.selectColumns('a', 'b') } | { it.orderBy('a') }`
- Filtering + mutate style:
  `matrix | { it.subset { it.age > 30 } } | { it.apply('salary') { it * 1.1 } }`
- Differences vs tidyverse `|>`:
  - Groovy pipe uses closures, so you reference the value as `it` (no placeholder)
  - It executes immediately (no lazy evaluation)

### 3.2 [x] Clipboard helpers
- Added `Matrix.toClipboard()` and `Matrix.builder().clipboard()` with native format support (no matrix-csv dependency)

---

## Priority 4: Validation

### 4.1 [ ] Run matrix-core tests
- Command: `./gradlew :matrix-core:test`
