# Matrix Spreadsheet v2.4.0 Release Roadmap

This document outlines the planned work for matrix-spreadsheet v2.4.0.

## Summary

v2.4.0 focuses on targeted refactoring, stronger test coverage (>= 70%),
performance benchmarking, and release hygiene.

---

## Priority 1: Testing & Performance (Must Do)

### 1.1 [x] Test coverage plan (target >= 70%)
- ✅ Completed in v2.3.0: Coverage achieved 79.74% (exceeds 70% target)
- See the detailed plan in v2.3.0 roadmap under "Test Coverage & Performance Plan".

### 1.2 [x] Add performance benchmarks for XLSX/ODS read/write
- ✅ Completed in v2.3.0: SpreadsheetBenchmark added with 50k x 12 and Crime_Data tests
- Baseline read/write timing for realistic datasets documented in v2.3.0 roadmap.

### 1.3 [x] Fix any performance regressions found in benchmarks
- ✅ Completed in v2.3.0: ODS performance improved 65-79% via Aalto parser and optimizations
- Before/after metrics captured: 4.86s → 1.70s (medium), 262s → 53s (large)

---

## Priority 2: Refactoring (Should Do)

### 2.1 [ ] Consider splitting FExcelAppender
- **File**: `src/main/groovy/se/alipsa/matrix/spreadsheet/fastexcel/FExcelAppender.groovy`
- **Issue**: ~750 lines with 11 inner classes
- **Consideration**: Could extract `WorkbookState`, `WorkbookPlan`, `SheetTemplate` to separate files
- **Note**: The class is well-structured internally; this is optional cleanup

### 2.2 [ ] Consider using Optional<Integer> in FExcelReader
- **File**: `src/main/groovy/se/alipsa/matrix/spreadsheet/fastexcel/FExcelReader.groovy`
- **Issue**: Returns -1 when sheet/content not found (lines 85, 97, 146)
- **Consideration**: Modern Java practice would use Optional<Integer>
- **Note**: This is a breaking API change; defer to v3.0 if needed

### 2.3 [ ] Consider more specific exception types in FileUtil
- **File**: `src/main/groovy/se/alipsa/matrix/spreadsheet/FileUtil.groovy`
- **Issue**: Throws generic `Exception` in several places
- **Note**: Low priority; current behavior works

---

## Priority 3: Release Checklist

- [ ] Remove SNAPSHOT suffix from build.gradle version when cutting release

