# matrix-avro v0.1.0 Roadmap

## Overview

This document outlines improvements and fixes needed to bring matrix-avro to feature parity with matrix-csv, matrix-json, and matrix-arff modules.

**Current Status (Updated 2026-01-23):**
- ✅ Core functionality implemented (read/write Avro OCF)
- ✅ Excellent test coverage (65 tests passing)
- ✅ Comprehensive README documentation
- ✅ Advanced type support (logical types, complex types)
- ✅ Binary content support (byte[] read/write)
- ✅ Input validation and error handling (Section 1) ✅
- ✅ Convenience methods (readFile, readUrl) (Section 2.2) ✅
- ✅ OutputStream support (Section 2.4) ✅
- ✅ Method-level GroovyDoc documentation (Section 3.1) ✅
- ✅ Private method documentation (Section 3.2) ✅
- ✅ Configuration options (Section 4) ✅
- ✅ Edge case tests (Section 6.2) ✅
- ✅ Improved error messages (Section 5.2) ✅

**Recent Progress:**
- ✅ Added `read(byte[] content, String name)` to MatrixAvroReader
- ✅ Added `writeBytes(Matrix matrix, boolean inferPrecisionAndScale)` to MatrixAvroWriter
- ✅ Added `readFile(String filePath)` convenience method to MatrixAvroReader
- ✅ Added `readUrl(String urlString)` convenience method to MatrixAvroReader
- ✅ Added `write(Matrix matrix, OutputStream out, boolean inferPrecisionAndScale)` to MatrixAvroWriter
- ✅ Added input validation to all reader and writer methods
- ✅ Added comprehensive GroovyDoc to all public and private methods
- ✅ Added `AvroReadOptions` class with matrixName, readerSchema, lenientTypeConversion
- ✅ Added `AvroWriteOptions` class with compression, namespace, schemaName, syncInterval
- ✅ Added overloaded read/write methods accepting options classes
- ✅ All 65 tests passing

---

## 1. Input Validation and Error Handling

### 1.1 Add Input Validation to MatrixAvroReader

**Priority:** HIGH → ✅ **COMPLETED**

Add validation consistent with `MatrixArffReader` patterns:

- [x] Add null checks for all File/Path/URL/InputStream parameters
- [x] Add file existence validation for File inputs
- [x] Add directory vs file validation (reject directories)
- [x] Add meaningful error messages for validation failures
- [x] Add validation for empty/corrupt Avro files

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`

**Validation tests added:**
- `testValidationNullFile()` - tests null File parameter
- `testValidationNullPath()` - tests null Path parameter
- `testValidationNullUrl()` - tests null URL parameter
- `testValidationNullInputStream()` - tests null InputStream parameter
- `testValidationNullByteArray()` - tests null byte[] parameter
- `testValidationNullFilePath()` - tests null file path string
- `testValidationNullUrlString()` - tests null URL string
- `testValidationFileDoesNotExist()` - tests FileNotFoundException
- `testValidationFileIsDirectory()` - tests directory rejection
- `testValidationInvalidUrlString()` - tests invalid URL format

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroReaderTest.testValidation*"
```

**Test results:** ✅ All tests passing

### 1.2 Add Input Validation to MatrixAvroWriter

**Priority:** MEDIUM → ✅ **COMPLETED**

- [x] Ensure `validateMatrix` is called in all write methods
- [x] Add null checks for File/Path/OutputStream parameters
- [x] Add directory validation for parent paths (auto-creates parent directories)
- [x] Add meaningful error messages

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**Validation tests added:**
- `testValidationNullMatrix()` - tests null Matrix parameter
- `testValidationEmptyMatrix()` - tests Matrix with no columns
- `testValidationNullFile()` - tests null File parameter
- `testValidationNullPath()` - tests null Path parameter
- `testValidationNullOutputStream()` - tests null OutputStream parameter
- `testValidationWriteBytesNullMatrix()` - tests null Matrix in writeBytes
- `testValidationWriteBytesEmptyMatrix()` - tests empty Matrix in writeBytes
- `testWriteToOutputStream()` - tests OutputStream write functionality
- `testWriteCreatesParentDirectory()` - tests auto-creation of parent directories

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroWriterTest.testValidation*"
```

**Test results:** ✅ All tests passing

---

## 2. API Surface Completeness

### 2.1 Add Binary Content Parsing to MatrixAvroReader

**Priority:** MEDIUM → ✅ **COMPLETED**

Add byte array parsing for binary Avro content:

- [x] Add `read(byte[] content, String name = "AvroMatrix")` method
- [x] Add validation for byte array (non-null check)
- [x] Add tests for binary content parsing

**Note:** Since Avro OCF is a binary format, accepting byte arrays is more natural than base64-encoded strings.

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`

**Tests added:**
- `readFromByteArray()` - tests byte[] reading with custom name
- `readFromByteArrayWithDefaultName()` - tests byte[] reading with default name

**Test results:** ✅ All 13 tests passing

### 2.2 Add Convenience Methods to MatrixAvroReader

**Priority:** HIGH → ✅ **COMPLETED**

Add helper methods consistent with matrix-json and matrix-arff:

- [x] Add `readFile(String filePath)` convenience method
- [x] Add `readUrl(String urlString)` convenience method
- [x] Add proper validation in helper methods
- [x] Add tests for convenience methods

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`

**Tests added:**
- `testReadFile()` - tests reading from file path string
- `testReadUrl()` - tests reading from URL string

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroReaderTest.testReadFile*"
./gradlew :matrix-avro:test --tests "MatrixAvroReaderTest.testReadUrl*"
```

**Test results:** ✅ All tests passing

### 2.3 Add Byte Array Output to MatrixAvroWriter

**Priority:** MEDIUM → ✅ **COMPLETED**

Add byte array output support for binary Avro content:

- [x] Add `writeBytes(Matrix matrix, boolean inferPrecisionAndScale = false)` method
- [x] Add validation for matrix (non-null check)
- [x] Add tests for byte array output
- [x] Add round-trip tests (writeBytes → read)

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**Tests added:**
- `writeBytesBasic()` - tests basic byte[] writing
- `writeBytesRoundTrip()` - tests writeBytes → read round-trip
- `writeBytesWithoutInference()` - tests byte[] writing without precision inference

**Test results:** ✅ All 13 tests passing

### 2.4 Add OutputStream Support to MatrixAvroWriter

**Priority:** MEDIUM → ✅ **COMPLETED**

Add output stream support consistent with matrix-arff:

- [x] Add `write(Matrix matrix, OutputStream out, boolean inferPrecisionAndScale = false)` method
- [x] Ensure proper resource management (caller closes streams)
- [x] Add tests for OutputStream output

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**Tests added:**
- `testWriteToOutputStream()` - tests writing to OutputStream and round-trip

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroWriterTest.testWriteToOutputStream*"
```

**Test results:** ✅ All tests passing

---

## 3. Documentation

### 3.1 Add GroovyDoc to All Public Methods

**Priority:** HIGH → ✅ **COMPLETED**

Add comprehensive GroovyDoc consistent with matrix-csv patterns:

**Reader methods documented:**
- [x] `read(File file, String name = null)` ✅
- [x] `read(Path path)` ✅
- [x] `read(URL url, String name = null)` ✅
- [x] `read(InputStream input, String name = "AvroMatrix")` ✅
- [x] `read(byte[] content, String name = "AvroMatrix")` ✅
- [x] `readFile(String filePath)` ✅
- [x] `readUrl(String urlString)` ✅

**Writer methods documented:**
- [x] `write(Matrix matrix, File file, boolean inferPrecisionAndScale = false)` ✅
- [x] `write(Matrix matrix, Path path, boolean inferPrecisionAndScale = false)` ✅
- [x] `write(Matrix matrix, OutputStream out, boolean inferPrecisionAndScale = false)` ✅
- [x] `writeBytes(Matrix matrix, boolean inferPrecisionAndScale = false)` ✅

**Documentation includes:**
- ✅ Method purpose and behavior
- ✅ Parameter descriptions with types
- ✅ Return value description
- ✅ Exceptions that may be thrown
- ✅ Usage examples (in class-level doc)
- ✅ Notes on resource management
- ✅ See-also references to related methods

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`

### 3.2 Add Private Method Documentation

**Priority:** LOW → ✅ **COMPLETED**

Add JavaDoc/GroovyDoc to complex private helper methods:

**Reader methods documented:**
- [x] `convertValue` - Avro to Java type conversion
- [x] `byteBufferToArray` - ByteBuffer to byte[] conversion
- [x] `toLocalDate` - Avro date to LocalDate
- [x] `toLocalTimeMillis` - Avro time-millis to LocalTime
- [x] `toLocalTimeMicros` - Avro time-micros to LocalTime
- [x] `toInstantMillis` - Avro timestamp-millis to Instant
- [x] `toInstantMicros` - Avro timestamp-micros to Instant
- [x] `toLocalDateTimeMillis` - Avro local-timestamp-millis to LocalDateTime
- [x] `toLocalDateTimeMicros` - Avro local-timestamp-micros to LocalDateTime
- [x] `toBigDecimal` - Avro decimal to BigDecimal

**Writer methods documented:**
- [x] `buildSchema` - Matrix to Avro schema generation
- [x] `toFieldSchema` - Java class to Avro schema mapping
- [x] `inferDecimalPrecisionAndScale` - BigDecimal precision/scale inference
- [x] `writeRows` - Row writing to Avro
- [x] `toAvroValue` - Java to Avro type conversion
- [x] `effectiveTypeForColumn` - Column type inference
- [x] `isRecordLikeColumn` - Map vs Record encoding decision
- [x] `inferListElemClass` - List element type inference
- [x] `inferMapValueClass` - Map value type inference
- [x] `isCompatible` - Union branch compatibility check

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`

**Test results:** ✅ All 65 tests passing

---

## 4. Configuration and Options

### 4.1 Add Reader Configuration Options

**Priority:** LOW → ✅ **COMPLETED**

Configuration options for reading:

- [x] Schema evolution handling (reader schema support)
- [x] Custom matrix name
- [x] Lenient type conversion option (placeholder for future use)

**Files created:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/AvroReadOptions.groovy`

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`

**API:**
```groovy
def options = new AvroReadOptions()
    .matrixName("MyData")
    .readerSchema(schema)
    .lenientTypeConversion(true)
Matrix m = MatrixAvroReader.read(file, options)
```

**Tests added:**
- `testReadWithOptionsCustomName()` - custom matrix name
- `testReadFromPathWithOptions()` - Path overload with options
- `testReadFromUrlWithOptions()` - URL overload with options
- `testReadFromByteArrayWithOptions()` - byte[] overload with options
- `testReadFromInputStreamWithOptions()` - InputStream overload with options
- `testReadWithOptionsNullValidation()` - null options validation
- `testReadWithOptionsDefaultName()` - default name handling

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroReaderTest.testRead*Options*"
```

**Test results:** ✅ All tests passing

### 4.2 Add Writer Configuration Options

**Priority:** LOW → ✅ **COMPLETED**

Configuration options for writing:

- [x] Custom schema namespace
- [x] Custom schema name
- [x] Compression codec options (NULL, DEFLATE, SNAPPY, BZIP2, XZ, ZSTANDARD)
- [x] Compression level
- [x] Sync marker interval
- [x] Infer precision and scale for BigDecimal

**Files created:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/AvroWriteOptions.groovy`

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**API:**
```groovy
def options = new AvroWriteOptions()
    .inferPrecisionAndScale(true)
    .namespace("com.example.data")
    .schemaName("MyData")
    .compression(AvroWriteOptions.Compression.DEFLATE)
    .compressionLevel(6)
    .syncInterval(64000)
MatrixAvroWriter.write(matrix, file, options)
```

**Tests added:**
- `testWriteWithOptions()` - namespace/schemaName options
- `testWriteWithDeflateCompression()` - compression + level
- `testWriteBytesWithOptions()` - options for writeBytes
- `testWriteWithOptionsNullValidation()` - null options validation
- `testWriteToOutputStreamWithOptions()` - OutputStream overload with options

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroWriterTest.testWrite*Options*"
./gradlew :matrix-avro:test --tests "MatrixAvroWriterTest.testWriteWithDeflateCompression"
```

**Test results:** ✅ All 65 tests passing

---

## 5. Error Handling Improvements

### 5.1 Add Custom Exceptions

**Priority:** LOW → ✅ **COMPLETED**

Custom exception types for better error handling:

- [x] `AvroSchemaException` - schema-related errors
- [x] `AvroConversionException` - type conversion errors
- [x] `AvroValidationException` - validation errors

**Files created:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/exceptions/AvroSchemaException.groovy`
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/exceptions/AvroConversionException.groovy`
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/exceptions/AvroValidationException.groovy`

**Files modified:**
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- ✅ `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**Notes:**
- `AvroConversionException` includes column name, row number, source/target types, and value.
- `AvroValidationException` includes parameter name, row number (when applicable), and suggestion.

### 5.2 Improve Error Messages

**Priority:** MEDIUM → ✅ **COMPLETED**

Add contextual error messages:

- [x] Include column names in conversion errors
- [x] Include row numbers in conversion errors
- [x] Include source vs target type information in conversion errors
- [x] Add helpful suggestions in validation errors
- [x] Include row numbers in validation errors (row-aware validation paths)
- [x] Include expected vs actual types in schema errors (wire AvroSchemaException into schema conflicts)

**Tests added:**
- `AvroExceptionTest` - validates conversion/schema exception context formatting
- `MatrixAvroWriterTest.testSchemaExceptionForTypeMismatch` - schema mismatch surface area
- `MatrixAvroWriterTest.testValidationExceptionForColumnSizeMismatch` - validation row context

**Files to modify:**
- `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroReader.groovy`
- `matrix-avro/src/main/groovy/se/alipsa/matrix/avro/MatrixAvroWriter.groovy`

---

## 6. Testing Enhancements

### 6.1 Add Validation Tests

**Priority:** HIGH → ✅ **COMPLETED**

Add tests for validation logic:

- [x] Test null parameter handling
- [x] Test file existence validation
- [x] Test directory vs file validation
- [x] Test empty file handling
- [x] Test corrupt file handling

**Files modified:**
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`
- ✅ `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvroReaderTest.testValidation*"
./gradlew :matrix-avro:test --tests "MatrixAvroWriterTest.testValidation*"
```

**Test results:** ✅ All validation tests passing

### 6.2 Add Edge Case Tests

**Priority:** MEDIUM → ✅ **COMPLETED**

Test boundary conditions and edge cases:

- [x] Empty Matrix (zero rows)
- [x] Single row Matrix
- [x] Single column Matrix
- [x] Special characters in string values
- [x] Unicode column names (rejected with schema error)
- [x] Large files (performance)

**Files to modify:**
- `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroReaderTest.groovy`
- `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroWriterTest.groovy`
- `matrix-avro/src/test/groovy/test/alipsa/matrix/avro/MatrixAvroEdgeCaseTest.groovy`

**Tests added:**
- `MatrixAvroEdgeCaseTest.testEmptyMatrixZeroRowsRoundTrip`
- `MatrixAvroEdgeCaseTest.testSingleRowRoundTrip`
- `MatrixAvroEdgeCaseTest.testSingleColumnRoundTrip`
- `MatrixAvroEdgeCaseTest.testSpecialCharactersInStringValuesRoundTrip`
- `MatrixAvroEdgeCaseTest.testUnicodeColumnNameRejected`
- `MatrixAvroEdgeCaseTest.testLargeFileRoundTrip`

**Test commands:**
```bash
./gradlew :matrix-avro:test --tests "MatrixAvro*Test.testEdgeCase*"
./gradlew :matrix-avro:test --tests "MatrixAvroEdgeCaseTest"
```

**Test results:** ✅ All 65 tests passing

---

## 7. Performance and Optimization

### 7.1 Benchmark Read/Write Performance

**Priority:** LOW → ✅ **COMPLETED**

Add performance benchmarks:

- [x] Large file read/write benchmark (standalone)
- [x] Schema inference benchmarks
- [x] Type conversion benchmarks
- [x] Compare with matrix-parquet performance

**Files created:**
- ✅ `matrix-avro/src/test/groovy/se/alipsa/matrix/avro/benchmarks/MatrixAvroBenchmark.groovy`
- ✅ `matrix-avro/src/test/groovy/se/alipsa/matrix/avro/benchmarks/MatrixAvroSchemaBenchmark.groovy`
- ✅ `matrix-avro/src/test/groovy/se/alipsa/matrix/avro/benchmarks/MatrixAvroConversionBenchmark.groovy`
- ✅ `matrix-avro/src/test/groovy/se/alipsa/matrix/avro/benchmarks/MatrixAvroParquetBenchmark.groovy`
- ✅ `matrix-avro/src/test/groovy/se/alipsa/matrix/avro/benchmarks/BenchmarkUtils.groovy`
- ✅ `matrix-avro/build.gradle` (benchmark task)

**Benchmark command:**
```bash
# args: rows warmups runs
./gradlew :matrix-avro:avroBenchmark -Prows=100000 -Pwarmups=2 -Pruns=5
./gradlew :matrix-avro:avroSchemaBenchmark -Prows=100000 -Pwarmups=2 -Pruns=5
./gradlew :matrix-avro:avroConversionBenchmark -Prows=50000 -Pwarmups=2 -Pruns=5
./gradlew :matrix-avro:avroParquetBenchmark -Prows=100000 -Pwarmups=2 -Pruns=5
```

### 7.2 Optimize Schema Inference

**Priority:** LOW

Review and optimize schema building:

- [x] Cache inferred schemas
- [x] Optimize BigDecimal precision detection
- [x] Optimize complex type detection

---

## Implementation Checklist

### Phase 1: Critical Features (v0.1.0) ✅ **COMPLETE**

- [x] 1.1 Add input validation to MatrixAvroReader ✅
- [x] 1.2 Add input validation to MatrixAvroWriter ✅
- [x] 2.2 Add convenience methods (readFile, readUrl) ✅
- [x] 3.1 Add GroovyDoc to all public methods ✅
- [x] 6.1 Add validation tests ✅

**Test commands:**
```bash
./gradlew :matrix-avro:test
./gradlew :matrix-avro:build
```

**Test results:** ✅ All 65 tests passing

### Phase 2: API Completeness (v0.2.0)

- [x] 2.1 Add binary content parsing ✅ **COMPLETED**
- [x] 2.3 Add byte array output (writeBytes) ✅ **COMPLETED**
- [x] 2.4 Add OutputStream support ✅ **COMPLETED**
- [x] 5.2 Improve error messages ✅
- [x] 6.2 Add edge case tests ✅

**Test commands:**
```bash
./gradlew :matrix-avro:test
./gradlew test
```

**Completed items:**
- ✅ Added `read(byte[] content, String name)` to MatrixAvroReader
- ✅ Added `writeBytes(Matrix matrix, boolean inferPrecisionAndScale)` to MatrixAvroWriter
- ✅ Added `write(Matrix matrix, OutputStream out, boolean inferPrecisionAndScale)` to MatrixAvroWriter
- ✅ Added 21 new tests (total 65 tests now passing)

### Phase 3: Advanced Features (v0.3.0) ✅ **COMPLETE**

- [x] 3.2 Add private method documentation ✅
- [x] 4.1 Add reader configuration options ✅
- [x] 4.2 Add writer configuration options ✅
- [x] 5.1 Add custom exceptions ✅

**Test commands:**
```bash
./gradlew :matrix-avro:test
./gradlew test
```

**Test results:** ✅ All 65 tests passing

### Phase 4: Performance (v1.0.0)

- [x] 7.1 Benchmark read/write performance
- [x] 7.2 Optimize schema inference
- [x] Final review and polish

**Test commands:**
```bash
./gradlew :matrix-avro:test
./gradlew test
./gradlew build
```

---

## Success Criteria

Before releasing v0.1.0, the following criteria must be met:

1. ✅ **API Parity:** matrix-avro has similar API surface to matrix-csv/json/arff
   - Input validation on all methods
   - Convenience methods (readFile, readUrl)
   - Comprehensive method overloads

2. ✅ **Documentation:** All public methods have comprehensive GroovyDoc
   - Parameter descriptions
   - Return value descriptions
   - Exception documentation
   - Usage examples

3. ✅ **Testing:** Test coverage includes validation and edge cases
   - Null parameter tests
   - File validation tests
   - Edge case tests
   - All tests passing

4. ✅ **Quality:** Code follows AGENTS.md guidelines
   - DRY principle (no duplication)
   - Idiomatic Groovy (BigDecimal, operators)
   - @CompileStatic where appropriate
   - Proper error handling

---

## Breaking Changes

**Note:** Adding new methods and validation is backward compatible. However, the following changes may affect existing code:

1. **Validation Exceptions:** Code that previously accepted null parameters will now throw `IllegalArgumentException`
2. **File Validation:** Code that passed directories instead of files will now throw exceptions
3. **Error Messages:** Exception messages will be more detailed (non-breaking but different)

**Mitigation:** Version as 0.1.0 to signal pre-1.0 API stability.

---

## Future Considerations

Features deferred beyond v1.0.0:

1. **Streaming API:** Support for processing large Avro files without loading entire Matrix into memory
2. **Schema Registry Integration:** Support for Confluent Schema Registry or similar
3. **Avro RPC Support:** If there's demand for Avro RPC (separate from OCF)
4. **Custom Codec Support:** Pluggable compression codecs
5. **Async I/O:** Asynchronous read/write operations

---

## Changelog

### Latest - Configuration Options

**Added:**
- `AvroWriteOptions` class for configuring write operations:
  - `compression(Compression)` - NULL, DEFLATE, SNAPPY, BZIP2, XZ, ZSTANDARD
  - `compressionLevel(int)` - codec-specific compression level
  - `namespace(String)` - custom schema namespace
  - `schemaName(String)` - custom schema name
  - `syncInterval(int)` - sync marker interval
  - `inferPrecisionAndScale(boolean)` - BigDecimal precision inference
- `AvroReadOptions` class for configuring read operations:
  - `matrixName(String)` - custom Matrix name
  - `readerSchema(Schema)` - schema evolution support
  - `lenientTypeConversion(boolean)` - lenient type handling
- Overloaded read/write methods accepting options classes
- 12 new tests for configuration options

**Previously Added (Input Validation):**
- Input validation to all `MatrixAvroReader` methods
- Input validation to all `MatrixAvroWriter` methods
- `MatrixAvroReader.readFile(String filePath)` convenience method
- `MatrixAvroReader.readUrl(String urlString)` convenience method
- `MatrixAvroWriter.write(Matrix, OutputStream, boolean)` method
- Comprehensive GroovyDoc for all public and private methods

**Previously Added (Binary Content Support):**
- `MatrixAvroReader.read(byte[] content, String name)` - Read Avro data from byte array
- `MatrixAvroWriter.writeBytes(Matrix, boolean)` - Write Matrix to byte array

**Status:**
- ✅ All 65 tests passing
- ✅ Configuration options complete
- ✅ Input validation complete
- ✅ Documentation complete
- ✅ API surface complete

**Completed Roadmap Items:**
- Section 1.1: Input validation for MatrixAvroReader ✅
- Section 1.2: Input validation for MatrixAvroWriter ✅
- Section 2.1: Binary content parsing ✅
- Section 2.2: Convenience methods (readFile, readUrl) ✅
- Section 2.3: Byte array output (writeBytes) ✅
- Section 2.4: OutputStream support ✅
- Section 3.1: GroovyDoc for all public methods ✅
- Section 3.2: GroovyDoc for private methods ✅
- Section 4.1: Reader configuration options (AvroReadOptions) ✅
- Section 4.2: Writer configuration options (AvroWriteOptions) ✅
- Section 5.1: Custom exceptions ✅
- Section 5.2: Improved error messages ✅
- Section 6.1: Validation tests ✅

**Phase 1 (v0.1.0) Status:** ✅ **COMPLETE** - All critical features implemented
**Phase 2 (v0.2.0) Status:** ✅ **COMPLETE** - API completeness achieved
**Phase 3 (Documentation & Config):** ✅ **COMPLETE** - All methods documented, options classes added

---

## Notes

- The matrix-avro module is currently in **0.1.0-SNAPSHOT** status
- This roadmap aligns with patterns established in matrix-csv, matrix-json, and matrix-arff
- Priority levels guide implementation order but may be adjusted based on user feedback
- Test commands should be executed after each task completion
- All changes must maintain backward compatibility where possible
- Follow AGENTS.md guidelines for code style, testing, and documentation
