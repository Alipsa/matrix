# Matrix-XChart v0.2.3 Release Roadmap

## Release Status

The matrix-xchart module provides **14 chart types** with **good functionality and test coverage**, but needs **@CompileStatic annotations** and **documentation improvements** before v0.2.3 release. Estimated effort: **2-3 hours**.

**Current State:**
- ‚úÖ All tests passing
- ‚úÖ Clean architecture with proper abstractions
- ‚úÖ Excellent GroovyDoc on concrete chart classes
- ‚úÖ No logging issues
- ‚ùå Missing @CompileStatic annotations (critical)
- ‚ùå Incomplete test methods
- ‚ùå Missing GroovyDoc on abstract classes
- ‚ùå README version mismatch

---

## Release Blocking Issues (MUST FIX)

### 1. Add @CompileStatic Annotations to All Chart Classes

**Priority:** CRITICAL
**Files:** All 14 chart classes + 3 abstract classes

**Issue:** No @CompileStatic annotations found on any classes. Per AGENTS.md: "Prefer `@CompileStatic` and only fall back to @CompileDynamic when static compilation would be significantly more convoluted." This is a performance and type safety issue.

**Chart Classes Requiring @CompileStatic:**
1. AreaChart.groovy
2. BarChart.groovy
3. BoxChart.groovy
4. BubbleChart.groovy
5. CorrelationHeatmapChart.groovy
6. HeatmapChart.groovy
7. HistogramChart.groovy
8. LineChart.groovy
9. OhlcChart.groovy
10. PieChart.groovy
11. RadarChart.groovy
12. ScatterChart.groovy
13. StickChart.groovy
14. MatrixTheme.groovy

**Abstract Classes Requiring @CompileStatic:**
15. AbstractChart.groovy
16. AbstractXYChart.groovy
17. AbstractCategoryChart.groovy

**Implementation:**
```groovy
import groovy.transform.CompileStatic

@CompileStatic
class AreaChart extends AbstractXYChart {
  // ... existing code
}
```

**Tasks:**
- 1.1 [x] Add @CompileStatic to all 14 concrete chart classes - **COMPLETE**
- 1.2 [x] Add @CompileStatic to all 3 abstract chart classes - **COMPLETE**
- 1.3 [x] Add @CompileStatic to MatrixTheme.groovy - **COMPLETE**
- 1.4 [x] Run tests after each batch to catch any type inference issues: `./gradlew :matrix-xchart:test` - **COMPLETE**
- 1.5 [x] Fix any compilation errors caused by static type checking - **COMPLETE**

**Status: ‚úÖ SECTION 1 COMPLETE - 100% STATIC COMPILATION**
- **Abstract classes (3/3):** ‚úÖ AbstractChart, AbstractXYChart, AbstractCategoryChart
- **XY Charts (4/4):** ‚úÖ AreaChart, LineChart, ScatterChart, BubbleChart
- **Category Charts (2/2):** ‚úÖ BarChart, StickChart
- **Other Charts (7/7):** ‚úÖ BoxChart, HeatmapChart, CorrelationHeatmapChart, HistogramChart, OhlcChart, PieChart, RadarChart
- **Theme (1/1):** ‚úÖ MatrixTheme
- **Total:** 17/17 files have @CompileStatic (excluding MatrixXChart interface)
- **Achievement:** ‚úÖ **ALL methods compile statically - NO @CompileDynamic needed!**

**Compilation & Test Results:**
- ‚úÖ All files compile successfully: `./gradlew :matrix-xchart:compileGroovy` - **BUILD SUCCESSFUL**
- ‚úÖ All tests pass: `./gradlew :matrix-xchart:test` - **BUILD SUCCESSFUL**

**Fixes Applied:**
1. **AbstractChart:** Fixed spread operator issue with Color[] array (lines 88-98)
2. **BubbleChart:** Fixed matrix column access using .column() instead of [] (lines 61, 65)
3. **ScatterChart:** Added type cast for MARKERS assignment (line 26)
4. **CorrelationHeatmapChart:** Fixed type inference with explicit casts (`a as int`, `b as int`) and proper type declarations
5. **HeatmapChart:**
   - Replaced `Math.sqrt()` with `.sqrt()` (line 63)
   - Added explicit type declarations (`List<List> tmpRows`, `List tmpRow`, `List<String> colNames`)
   - Fixed Row type handling with `(row as Row).minusColumn(byIdx)` (line 114)
   - All methods now compile statically without @CompileDynamic
6. **HistogramChart:** Fixed to compile statically
7. **PieChart:** Fixed to compile statically

**Achievement Note:**
All code in the matrix-xchart module now uses **@CompileStatic with full static type checking** - no @CompileDynamic fallbacks needed. This provides:
- ‚úÖ Maximum performance (no dynamic dispatch overhead)
- ‚úÖ Compile-time type safety across entire codebase
- ‚úÖ Better IDE support and refactoring capabilities

**Note:** If static compilation fails for specific methods, use `@CompileDynamic` on those methods only, not the entire class.

---

### 2. Complete Empty Test Methods in HistogramChartTest

**Priority:** HIGH
**File:** `src/test/groovy/test/alipsa/matrix/xchart/HistogramChartTest.groovy`

**Issue:** Two test methods were empty placeholders with TODO comments.

**Empty Tests:**
1. `testDesityHistogram()` - Line ~27
2. `testFrequencyHistogramCustom()` - Line ~54

**Tasks:**
- 2.1 [x] Implement testDesityHistogram() to test density histogram functionality - **COMPLETE**
- 2.2 [x] Implement testFrequencyHistogramCustom() to test custom frequency histogram - **COMPLETE**
- 2.3 [x] Run tests: `./gradlew :matrix-xchart:test --tests "HistogramChartTest"` - **SUCCESS (5 tests passed)**

**Status: ‚úÖ SECTION 2 COMPLETE**

**Implementation Details:**

**testDesityHistogram():**
- Creates histogram with Scott's rule for optimal bin width
- Sets custom title and X-axis label
- Exports to PNG and verifies file creation
- Equivalent to R: `hist(airquality$Temp, main="...", xlab="...", freq=FALSE)`

**testFrequencyHistogramCustom():**
- Creates histogram using Freedman-Diaconis rule for bin calculation
- Tests custom bin width calculation: `(max - min) / freedmanDiaconisRule`
- Exports to PNG and verifies file creation
- Note: Y-axis range setting not supported by CategoryStyler (documented in comments)
- Equivalent to R: `h <- hist(airquality$Temp)`

**Example Implementation:**
```groovy
@Test
void testDesityHistogram() {
  Matrix data = Matrix.builder()
      .data(values: [1.1, 1.5, 2.0, 2.3, 2.8, 3.2, 3.5, 4.0, 4.5, 5.0])
      .types([Double])
      .build()

  def chart = HistogramChart.createDensity(data, 'values', 600, 400)
  assertNotNull(chart)
  assertNotNull(chart.xchart)

  File output = new File("build/testDesityHistogram.png")
  chart.exportPng(output)
  assertTrue(output.exists())
}
```

---

### 3. Add GroovyDoc to Abstract Classes and Interface

**Priority:** HIGH
**Files:**
- `src/main/groovy/se/alipsa/matrix/xchart/abstractions/MatrixXChart.groovy`
- `src/main/groovy/se/alipsa/matrix/xchart/abstractions/AbstractChart.groovy`
- `src/main/groovy/se/alipsa/matrix/xchart/abstractions/AbstractXYChart.groovy`
- `src/main/groovy/se/alipsa/matrix/xchart/abstractions/AbstractCategoryChart.groovy`

**Issue:** Abstract classes and interface lack GroovyDoc, making the API harder to understand for developers extending the library.

**Required Documentation:**

**MatrixXChart.groovy:**
```groovy
/**
 * Base interface for all Matrix chart types.
 * Provides access to the underlying XChart instance and basic chart properties.
 */
interface MatrixXChart {
  /**
   * Get the underlying XChart chart instance.
   * @return the XChart chart object
   */
  Chart getXchart()

  /**
   * Get the chart title.
   * @return the chart title, or null if not set
   */
  String getTitle()

  /**
   * Get the chart width in pixels.
   * @return the chart width
   */
  int getWidth()

  /**
   * Get the chart height in pixels.
   * @return the chart height
   */
  int getHeight()
}
```

**AbstractChart.groovy:**
```groovy
/**
 * Base class for all Matrix chart implementations.
 * Provides common functionality for chart creation, styling, and export.
 *
 * <p>Subclasses must initialize the 'xchart' field with the appropriate XChart type.</p>
 */
abstract class AbstractChart implements MatrixXChart {
  // ... add method-level GroovyDoc for all public methods
}
```

**Tasks:**
- 3.1 [x] Add class-level GroovyDoc to MatrixXChart interface - **COMPLETE**
- 3.2 [x] Add method-level GroovyDoc to all MatrixXChart interface methods - **COMPLETE**
- 3.3 [x] Add class-level GroovyDoc to AbstractChart - **COMPLETE**
- 3.4 [x] Add method-level GroovyDoc to all public AbstractChart methods (exportPng, exportSvg, etc.) - **COMPLETE**
- 3.5 [x] Add class-level GroovyDoc to AbstractXYChart - **COMPLETE**
- 3.6 [x] Add class-level GroovyDoc to AbstractCategoryChart - **COMPLETE**
- 3.7 [x] Generate GroovyDoc to verify: `./gradlew :matrix-xchart:groovydoc` - **COMPLETE**

**Status: ‚úÖ SECTION 3 COMPLETE - All Abstract Classes Documented**

**Documentation Added:**
- **MatrixXChart interface:** Complete class-level and method-level GroovyDoc for all 7 methods (exportPng, exportSvg, exportSwing, display, getXChart)
- **AbstractChart:** Class-level GroovyDoc with detailed descriptions of responsibilities, type parameters, and all public methods documented
- **AbstractXYChart:** Class-level GroovyDoc describing XY chart types and their purpose
- **AbstractCategoryChart:** Class-level GroovyDoc describing category chart types and their purpose
- **GroovyDoc generation:** Successfully verified with `./gradlew :matrix-xchart:groovydoc`

---

### 4. Update README.md Version References

**Priority:** HIGH
**File:** `README.md`
**Location:** Line 13

**Issue:** README shows version 0.2.1 but build.gradle is 0.2.3-SNAPSHOT.

**Current:**
```groovy
implementation 'se.alipsa.matrix:matrix-xchart:0.2.1'
```

**Required fix:**
```groovy
implementation 'se.alipsa.matrix:matrix-xchart:0.2.3'
```

**Tasks:**
- 4.1 [x] Update README line 13 to version 0.2.3 - **COMPLETE**
- 4.2 [x] Verify other version references are correct (matrix-core:3.3.0, groovy:5.0.4) - **COMPLETE**

**Status: ‚úÖ SECTION 4 COMPLETE - README Version Updated**

**Changes Made:**
- Updated matrix-xchart version from 0.2.1 to 0.2.3 in README.md line 13
- Verified Groovy version 5.0.4 is correct (matches dependencies.gradle)
- Verified matrix-core version 3.3.0 is correct published version (development is at 3.6.0-SNAPSHOT)

---

### 5. Complete StickChart Description in README

**Priority:** HIGH
**File:** `README.md`
**Location:** Line 79

**Issue:** StickChart description is incomplete (cuts off mid-sentence).

**Current:**
```markdown
- [StickChart](https://github.com/Alipsa/matrix/blob/main/matrix-xchart/src/main/groovy/se/alipsa/matrix/xchart/StickChart.groovy)
  -
```

**Required fix:**
```markdown
- [StickChart](https://github.com/Alipsa/matrix/blob/main/matrix-xchart/src/main/groovy/se/alipsa/matrix/xchart/StickChart.groovy)
  - A stick chart displays data as vertical lines extending from the x-axis. Similar to a bar chart but with lines instead of bars, useful for showing discrete data points.
```

**Tasks:**
- 5.1 [x] Add complete StickChart description to README.md line 79 - **COMPLETE**
- 5.2 [x] Review other chart descriptions for completeness - **COMPLETE**

**Status: ‚úÖ SECTION 5 COMPLETE - StickChart Description Added**

**Changes Made:**
- Added complete description: "A stick chart displays data points as vertical lines (sticks) extending from a baseline. It is useful for visualizing the distribution of data points along a category axis, similar to a bar chart but using lines instead of bars."
- Reviewed all 14 chart descriptions in README - all are now complete

---

## Recommended Improvements (SHOULD FIX)

### 6. Replace Math Calls with NumberExtension Methods

**Priority:** MEDIUM
**Files:** 2 occurrences across 2 files

**Issue:** Per AGENTS.md, should prefer NumberExtension methods over java.lang.Math for idiomatic Groovy code.

**Occurrence 1: AbstractChart.groovy:90**
```groovy
// Current
def multiple = Math.ceil(style.theme.seriesColors.size() / numSeries).intValue()

// Preferred
def multiple = (style.theme.seriesColors.size() / numSeries).ceil() as int
```

**Occurrence 2: HeatmapChart.groovy:59**
```groovy
// Current
int nCols = columns ?: (Math.sqrt(col.size() as int))

// Preferred
int nCols = columns ?: ((col.size() as int) ** 0.5) as int
// Or
int nCols = columns ?: (col.size() as int).sqrt() as int
```

**Tasks:**
- 6.1 [x] Replace Math.ceil() with NumberExtension.ceil() in AbstractChart.groovy:183 - **COMPLETE**
- 6.2 [x] Replace Math.sqrt() with .sqrt() in HeatmapChart.groovy:64 - **COMPLETE** (already fixed in Section 1)
- 6.3 [x] Run tests: `./gradlew :matrix-xchart:test` - **COMPLETE** (all tests pass)

**Status: ‚úÖ SECTION 6 COMPLETE - All Math Calls Replaced**

**Changes Made:**
- **AbstractChart.groovy:183**: Changed `Math.ceil(style.theme.seriesColors.size() / numSeries).intValue()` to `(style.theme.seriesColors.size() / numSeries).ceil() as int`
- **HeatmapChart.groovy:64**: Already using `.sqrt()` (fixed in Section 1 during static compilation)
- **Verification**: All tests pass, no performance regression detected
- **Result**: Zero Math.* calls remaining in matrix-xchart codebase (verified with grep)

**Note:** These are in performance-sensitive code paths, so verify there's no performance regression.

---

### 7. Remove Commented println Statements

**Priority:** LOW
**Files:** 2 occurrences

**Issue:** Commented-out debugging println statements should be removed for code cleanliness.

**Occurrence 1: CorrelationHeatmapChart.groovy:66**
```groovy
// Remove: //println "$row, $col -> ${heatMapData.get([row, col])}"
```

**Occurrence 2: RadarChart.groovy:56**
```groovy
// Remove: //println "Adding series $label with values: $r"
```

**Tasks:**
- 7.1 [ ] Remove commented println from CorrelationHeatmapChart.groovy:66
- 7.2 [ ] Remove commented println from RadarChart.groovy:56

---

## Additional Improvements (NICE TO HAVE)

### 8. Expand GroovyDoc on Public Methods

**Priority:** LOW

Add detailed GroovyDoc to all public methods in AbstractChart:
- exportPng()
- exportSvg()
- exportJpg()
- display()
- theme()
- title()

**Example:**
```groovy
/**
 * Export the chart to a PNG file.
 *
 * @param file the output file (will be created or overwritten)
 * @return this chart for method chaining
 * @throws IOException if the file cannot be written
 */
AbstractChart exportPng(File file) {
  // ... existing code
}
```

**Tasks:**
- 8.1 [ ] Add detailed GroovyDoc to all AbstractChart public methods
- 8.2 [ ] Add @param and @return tags where missing
- 8.3 [ ] Generate and review: `./gradlew :matrix-xchart:groovydoc`

---

### 9. Add More Comprehensive Test Examples

**Priority:** LOW

Add tests for edge cases:
- Empty datasets
- Single data point
- Null handling
- Large datasets (performance testing)
- All theme variations

**Tasks:**
- 9.1 [ ] Add edge case tests for each chart type
- 9.2 [ ] Add theme variation tests
- 9.3 [ ] Document any performance characteristics

---

## Release Checklist

### Pre-Release Tasks

- [ ] All blocking issues (1-5) are resolved
- [ ] All tests pass: `./gradlew :matrix-xchart:test`
- [ ] Run full project tests: `./gradlew test`
- [ ] No test failures or warnings
- [ ] Build succeeds: `./gradlew :matrix-xchart:build`
- [ ] GroovyDoc generates without errors: `./gradlew :matrix-xchart:groovydoc`
- [ ] Review generated docs in `build/docs/groovydoc/`
- [ ] Verify @CompileStatic compilation succeeds with no warnings

### Version Management

- [ ] Update version in build.gradle from `0.2.3-SNAPSHOT` to `0.2.3`
- [ ] Verify README examples still work with final version
- [ ] Update dependency versions if needed

### Publication

- [ ] Publish to Maven local: `./gradlew :matrix-xchart:publishToMavenLocal`
- [ ] Test integration with matrix-core
- [ ] Create release tag: `git tag matrix-xchart-0.2.3`
- [ ] Push to Maven Central (if applicable)

### Documentation

- [ ] Update main project README to mention matrix-xchart updates
- [ ] Add matrix-xchart examples to matrix-examples (if desired)
- [ ] Update AGENTS.md module table if needed

---

## Module Quality Summary

### ‚úÖ Strengths

- **Excellent architecture:** Clean abstraction layers with proper inheritance
- **Comprehensive functionality:** 14 different chart types covering most use cases
- **Good test coverage:** All chart types tested with file export verification
- **Strong documentation:** Excellent GroovyDoc on all concrete chart classes
- **No code smells:** No .doubleValue() usage, no logging issues, no old-style switch statements
- **Good error handling:** Clear validation and error messages
- **Proper dependencies:** Correct use of compileOnly and implementation scopes

### ‚ö†Ô∏è Areas for Improvement

- **Missing @CompileStatic:** No static compilation (critical performance issue)
- **Incomplete tests:** 2 empty test methods need implementation
- **Missing GroovyDoc:** Abstract classes lack documentation
- **Documentation gaps:** README version mismatch, incomplete StickChart description
- **Minor code issues:** 2 Math.* calls that should use NumberExtension
- **Dead code:** 2 commented println statements

### üìä Metrics

- **Source files:** 18 (14 charts + 3 abstractions + 1 theme)
- **Test files:** 10
- **Lines of code:** ~1,287 (source)
- **Chart types:** 14
- **Test count:** ~24 tests (2 empty)
- **GroovyDoc:** Good on concrete classes, missing on abstractions
- **@CompileStatic usage:** 0/18 files (0%)

---

## Notes

- The module interfaces with XChart 3.8.8, which requires primitive arrays in some places
- Some `as double[]` conversions are required by the XChart API and cannot be avoided
- The MatrixTheme provides a custom color scheme inspired by MatLab
- All chart types support export to PNG, SVG, and Swing display
- The module is well-structured and functional, but needs @CompileStatic for production readiness

---

## Estimated Effort

**Total Time:** 2-3 hours

- **Blocking Issues (1-5):** 1.5-2 hours
  - Add @CompileStatic: 45-60 minutes (testing and fixing issues)
  - Complete test methods: 20-30 minutes
  - Add GroovyDoc: 20-30 minutes
  - README updates: 5-10 minutes

- **Recommended Improvements (6-7):** 30 minutes
  - Replace Math calls: 15 minutes
  - Remove comments: 5 minutes
  - Testing: 10 minutes

- **Additional Improvements (8-9):** 1-2 hours (optional)
